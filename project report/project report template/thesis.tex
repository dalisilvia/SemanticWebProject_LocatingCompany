% do not change these two lines (this is a hard requirement
% there is one exception: you might replace oneside by twoside in case you deliver 
% the printed version in the accordant format
\documentclass[11pt,titlepage,oneside,openany]{book}
\usepackage{times}


\usepackage{graphicx}
\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{ntheorem}

% \usepackage{paralist}
\usepackage{tabularx}
\usepackage{url}

% this packaes are useful for nice algorithms
\usepackage{algorithm}
\usepackage{algorithmic}

% well, when your work is concerned with definitions, proposition and so on, we suggest this
% feel free to add Corrolary, Theorem or whatever you need
\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}


% its always useful to have some shortcuts (some are specific for algorithms
% if you do not like your formating you can change it here (instead of scanning through the whole text)
\renewcommand{\algorithmiccomment}[1]{\ensuremath{\rhd} \textit{#1}}
\def\MYCALL#1#2{{\small\textsc{#1}}(\textup{#2})}
\def\MYSET#1{\scshape{#1}}
\def\MYAND{\textbf{ and }}
\def\MYOR{\textbf{ or }}
\def\MYNOT{\textbf{ not }}
\def\MYTHROW{\textbf{ throw }}
\def\MYBREAK{\textbf{break }}
\def\MYEXCEPT#1{\scshape{#1}}
\def\MYTO{\textbf{ to }}
\def\MYNIL{\textsc{Nil}}
\def\MYUNKNOWN{ unknown }
% simple stuff (not all of this is used in this examples thesis
\def\INT{{\mathcal I}} % interpretation
\def\ONT{{\mathcal O}} % ontology
\def\SEM{{\mathcal S}} % alignment semantic
\def\ALI{{\mathcal A}} % alignment
\def\USE{{\mathcal U}} % set of unsatisfiable entities
\def\CON{{\mathcal C}} % conflict set
\def\DIA{\Delta} % diagnosis
% mups and mips
\def\MUP{{\mathcal M}} % ontology
\def\MIP{{\mathcal M}} % ontology
% distributed and local entities
\newcommand{\cc}[2]{\mathit{#1}\hspace{-1pt} \# \hspace{-1pt} \mathit{#2}}
\newcommand{\cx}[1]{\mathit{#1}}
% complex stuff
\def\MER#1#2#3#4{#1 \cup_{#3}^{#2} #4} % merged ontology
\def\MUPALL#1#2#3#4#5{\textit{MUPS}_{#1}\left(#2, #3, #4, #5\right)} % the set of all mups for some concept
\def\MIPALL#1#2{\textit{MIPS}_{#1}\left(#2\right)} % the set of all mips


\begin{document}

\pagenumbering{roman}
% lets go for the title page, something like this should be okay
\begin{titlepage}
	\vspace*{2cm}
  \begin{center}
   {\Huge Finding Generic Drugs \\}
	\vspace*{0.5cm}
   {\large  interlinking DBPedia with FreeDB based on drug brands \\}
   \vspace{2cm} 
   \vspace{2cm}
   {written by\\
    Markus Dietsche 1513384 \\
    Dandan Li 1486051\\
   }
   \vspace{1cm} 
   {submitted to the\\
    Data and Web Science Group \\
    Prof.\ Dr.\ Paulheim\\
    University of Mannheim\\} \vspace{2cm}
   {December 2015}
  \end{center}
\end{titlepage} 

% no lets make some add some table of contents
\tableofcontents
\newpage

%\listofalgorithms %TODO: we dont need it

%\listoffigures %TODO: we dont need it

%\listoftables %TODO: we dont need it

% evntuelly you might add something like this
% \listtheorems{definition}
% \listtheorems{proposition}

\newpage


% okay, start new numbering ... here is where it really starts
\pagenumbering{arabic}

% Legend:
% TODO: 	general todo, doesnt matter who takes care of it
% TODO M: 	todo for Markus
% TODO S: 	todo for Silvia


\chapter{Application domain and goals}
\label{cha:domain}
This documents describes the development of a generics search engine, based on the publicly available knowledge bases DBPedia\footnote{\url{www.dbpedia.org}} and FreeBase\footnote{\url{www.freebase.com}}. Furthermore it discusses the limitations of the corresponding TRL6\footnote{Technology Readiness Level \url{http://resources.sei.cmu.edu/library/asset-view.cfm?assetID=5835}} prototype and contains proposals for further development.

\paragraph{Problem} \label{sec:problem}
% Which user information needs are addressed
Currently people are forced to rely on expert opinion to find a substitute, e.g a cheaper alternative, to their medication. Since many experts, like doctors or pharmacists, are granted benefits from pharmaceutical companies their judgment is often assorted to be biased.
Furthermore drugs often have fantasy names, due to marketing reasons. This is in particular the case for over-the-counter drugs. Therefore a comparison is only possible based ingredients.
In case of drugs without patent protection this potentially results in filtering thousands of different drugs by their ingredients. Needless to say that even well informed an unbiased expert will not know all generics by heart.


\paragraph{Solution} 
%\paragraph{Target group}\label{sec:users}
% Which users are targeted?
The search engine is designed for private individuals, without any medical expert knowledge.
\label{sec:solution} % Which user problems are solved?
 By entering a drug brand name, ATC code\footnote{Anatomical Therapeutic Chemical (ATC) Classification System} or active substance the prototype will return a list of identical substitute drugs and their corresponding drug manufacturers.


\chapter{Datasets}
\label{cha:datasets}

\paragraph{Datasets used}
\label{sec:datasets_used}
% which datasets does the application use
The application uses drug datasets extracted from DBPedia and FreeBase with correspondent SPARQL query.

\subparagraph{DBPedia}
\label{dbpedia}
% TODO S: describe DBPedia (important: dont copy and paste + cite correctly!)
fetches all alternative generics of the targeted drug by a certain propery \textit{ dbo:wikiPageRedirects\footnote{\url{http://dbpedia.org/ontology/wikiPageRedirects}}} and then saves the results name as an input for FreeBase dataset.
\subparagraph{FreeBase}
\label{freebase}
% TODO S: describe FreeBase (important: dont copy and paste + cite correctly!)
searches drug manufacturers for every alternative generics and integrate the result to users.

Differences vs DB Pedai
\footnote{\url{http://wiki.freebase.com/wiki/DBPedia}}

(page \pageref{prob:freebase})





\paragraph{Access methods}
\label{sec:access_methods}
% how are they accessed
% TODO S: Which access methods did we chose and why did we chose them?



\paragraph{Combination of knowledge bases}
\label{sec:dataset_combination}
% how are they combined

I. DBPedia
(a) withdraw list of \textit{dbo:wikiPageRedirect}
(b) if search term is a redirect -> follow redirect and (a)

II. Filter 
DBPedia has redirects for different brands of the same drug, ATC codes and chemical formulas. Fortunately ATC code label contain \_code\_ and (most) formulas end with \_acid. Therefore an entity with these labels does not need to be considered in III.

III. FreeBase
(a) Check if search term is a \textit{drug\_brand} receive \textit{manufacturer}, a list of \textit{products} and the \textit{website} of the manufacturer.
(b) For each of the products, receive \textit{manufacturer} and \textit{website}. 
Remark: it is possible that different products of the same brand are produced from different manufacturer.
(c) In case FreeBase has no separate entity for a search term, it might still has it as a alias for a \text{drug}.


\chapter{Techniques Used}
\label{cha:technique}
%TODO: add paragraphs for the techniques we are using



The techniques applied in our project will be discussed in this section. The viable prototype, which was also used for the field trial (-> page \pageref{sec:field_trial}), is available at \url{http://generics.markus-dietsche.de}.

\paragraph{Prototype}
\label{sec:prototype}


To ensure a user-friendly field trial, a web application was developed. It's based on 
Django\footnote{\url{https://www.djangoproject.com/}}, a framework for web applications written in Python and Bootstrap\footnote{\url{https://getbootstrap.com/}} a web frontend framework.

SPARQL, a query language to access Resource Description Framework (RDF) data, is used to access DBPedia via it's SPARQL endpoint. On client side SPARQLWrapper\footnote{\url{https://rdflib.github.io/sparqlwrapper/}} is used to facilitate the query creation and result converting. 


Metaweb Query Language MQL\footnote{\url{https://developers.google.com/freebase/v1/mql-overview}}, is the endorsed way to access information from FreeBase. MQL was chosen since the official SPARQL endpoint\footnote{\url{http://www.freebase.com/base/sparql}} of FreeBase is offline, the FactForge endpoint\footnote{\url{http://factforge.net/sparql}} is unreliable and slow and a local installation would consume with 250GB\footnote{\url{https://developers.google.com/freebase/data}} too much space for testing purposes.

Freebase stores information in n-tuples, unlike DBpedia which stores data in RDF triplets. Therefore MQL queries against FreeBase are easier to write than SPARQL queries.


Since the discontinuance of freebase (page \pageref{prob:freebase}) registration is impossible. Unfortunately the official freebase python wrapper \footnote{\url{https://code.google.com/p/freebase-python/}} requires a user account and can therefore not be used. Due to this a homegrown MQL wrapper, to access the web MQL client, was written.



  \paragraph{TODO}
\label{sec:TODO}


\chapter{Evaluation}
\label{cha:evaluation}

\paragraph{Example results}
\label{cha:example}

TODO S

\paragraph{Field Trial}
\label{cha:field_trial}
A field trial with 35 testers was conducted from 6th of December 2015 until the 8th of December.

Thanks to the support of Dr. Diana Bursan (Iuliu Ha»õieganu University of Medicine and Pharmacy) 11 Romanian medical experts delivered feedback from a professional point of view (group A). This is in particular important because the target user group described on page \pageref{cha:domain} can not rate the quality and completeness of the results.
In addition 24 random non-experts (group B) from Germany, Romania and Canada participated and represented the target user group, their feedback will be discussed in the outcome section on page \pageref{sec:outcome}. 

A total of 309 queries\footnote{Queries are conducted anonymously, so there is no information about which group conducted them.} was analyzed. 184 queries returned results (59.5\%), 102 were misspelled, which mostly was due to the first letter being lowercase or the brand name in foreign languages (33.0\%), and 23 (7.5\%) did not return any results.  

\paragraph{Quality of knowledge base linkage}
\label{cha:example}

TODO S

\paragraph{Outcome}
\label{sec:outcome}
% What outcomes does the application provide?
% TODO: what is meant by "outcome"?
To quantify the outcome a field trial has been conducted (-> page \pageref{cha:field_trial}). Group \textbf{(A)} consists of medical professionals and \textbf{(B)} the target user group.

\textbf{(A) medical experts} stated that the majority of brands in the result set are from the North American market and many European brands are not contained. Furthermore many brands have different names in different languages, in the fewest cases those ones are considered.

\textit{"Generics search helped me as a foreign doctor abroad in finding immediately the commercial names of all drugs."} - Dr. Dalia Onetiu, Romanian Doctor working in France

\textbf{(B) target user group} The biggest obstacle for the target user group is the correct spelling of the sometimes unusual drug names. Furthermore the tend to search for over-the-counter drug cocktails (e.g. Neo Citran) which are not considered in the search at all.

\paragraph{Conclusion}
\label{sec:conclusion}

On obstacles remains for the non-expert target user group: 
A large percentage of over-the-counter drugs often contain multiple active substances (e.g. a pain killer + caffeine is a common combination). Those ones can not be found by this approach, since DBPedia only considers two drugs to be the same when they contain the the same substance and no other active substances.

Based on the field study and the analyzed queries the results cater more to a professional user group than initially expected. Therefore the rational conclusion is to change the focus to an medical expert target group and cater to their need.


% TODO: Aspirin (drug from Bayer) among them Ecotrin (-> finds 2 manufacturers for Ecotrin + generics)
% TODO: Lamotrigine (active substance)

\label{ex:ecotrin}


\chapter{Known limitations}
\label{cha:limiations}

%{S_note}
%The result of DBPedia may have different value format from Freebase.

%The DBPedia results also contain active substances which may result in wrong %manufacturers from Freebase.

\label{prob:freebase}

\paragraph{FreeBase}
Google decided to discontinue FreeBase in June 2015\footnote{\url{https://plus.sandbox.google.com/109936836907132434202/posts/bu3z2wVqcQc}} to support the growth of Wikidata, which does currently not contain the information this project requires. Due to this the project switched into read-only mode and the knowledge will not further expand. The only possibility for the search engine to improve is if DBPedia adds new redirects for which FreeDB already contains information. 

\paragraph{Filtering}
In some cases DBPedia redirects form syntactically incorrect chemical formulas and APC codes (-> page \pageref{sec:filtering}) \textbf{Workaround} A more elaborated regular expression for filtering.

\paragraph{Current manufacturer}
% TODO: formulate
FreeBase does not consider the time dimension for ownership. Therefore multiple drug manufacturers can be found for the same brand if the brand was e.g. sold. An example is Ecotrin (-> page \pageref{ex:ecotrin}) which was developed and produced by GlaxoSmithKline. In 2011 it was sold in bundle deal to Prestige Brands, which is its current manufacturer.
% TODO: formulate
\textbf{Workaround} crawl information from trademark registers. Add information about production time frames to output, since drugs produced from previous brand owners could still be queried.

\paragraph{Quantity of active substance}
% TODO: formulate
DBPedia does refer all generics to a single entity, it does not contain information about the quantity of active substances. Therefore a 500mg Aspirin is considered the same as a 200mg Aspirin.
% TODO: formulate
\textbf{Workaround} filter quantity from user input and check it on corresponding FreeDB pages.



\paragraph{Impossible queries}
\label{sec:drug_cocktail}
\subparagraph{Multi ingredient drugs} No multi ingredient drugs e.g. "Neo Citran". Because DBPedia does not consider it as a SameAs relationship -> no generics found.

\subparagraph{Drugs not listen as sameAs}
\label{sec:drug_sameAs}
% TODO: formulate
If a drug is not linked correctly on DBPedia, e.g. it has an own page, even if the ingredients are identical, the search wont function.

\subparagraph{Drugs brands with different names}
\label{sec:drug_foregin_name}
% TODO: formulate

\subparagraph{Spell check}
\label{sec:drug_spellcheck}
% TODO: formulate

\paragraph{Lessons learned}
\label{cha:lessons}
%TODO: at the end


% TODO: delete?


\paragraph{Challenges}
\label{sec:challenges}

\subparagraph{Selection of knowledge bases} Our initial project proposal, searching manufacturers of certain product categories and visualizing them on Google maps, had to be discarded, since ProductDB was shut down, no dump is available and the only known maintainer is unreachable. Furthermore the usage of FreeBase is sub-optimal since it is discontinued. Yet we did not find an alternative source for the drug details we required. 


\subparagraph{FreeBase access}
\label{sec:challenges}
To gain stable access to FreeBase (FB) was harder than expected. Since the official SPARQL endpoint is offline, FactForge was initially chosen, as the only publicly available replacement. Yet it turned out that it's unreliably slow and occasionally unreachable. Since the data dump has a uncompressed size of 250 GB a local instance was not an option. 
So we decided to use the endorsed way to access FB: MQL. After the queries have been rewritten and tested in the FB online MQL client it turned out that the official MQL wrapper requires a FB account, and the registration is closed for good.
Luckily there is an MQL web API from google, which returns the results as JSON. Based on this we developed a homebrewn wrapper for the web API.


\appendix
%\chapter{Further Experimental Results}
%\label{cha:appendix-b}

%TODO: section needed?
\newpage

\end{document}
